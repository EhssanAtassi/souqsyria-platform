<!-- Filter Sidebar Container -->
<div class="filter-sidebar" [attr.dir]="language() === 'ar' ? 'rtl' : 'ltr'">

  <!-- Header -->
  <div class="filter-header">
    <div class="filter-title">
      <mat-icon class="filter-icon">filter_list</mat-icon>
      <h3>{{ language() === 'ar' ? 'تصفية المنتجات' : 'Filter Products' }}</h3>
    </div>

    @if (hasActiveFilters()) {
      <button
        mat-button
        class="clear-all-btn"
        (click)="clearAll()">
        <mat-icon>clear_all</mat-icon>
        {{ language() === 'ar' ? 'مسح الكل' : 'Clear All' }}
      </button>
    }
  </div>

  <mat-divider></mat-divider>

  <!-- Active Filters Count Badge -->
  @if (activeFilterCount() > 0) {
    <div class="active-filters-badge">
      <mat-icon>check_circle</mat-icon>
      <span>
        {{ activeFilterCount() }} {{ language() === 'ar' ? 'تصفية نشطة' : 'Active Filters' }}
      </span>
    </div>
  }

  <!-- Filter Sections -->
  <mat-accordion class="filter-accordion">

    <!-- Price Range Filter -->
    <mat-expansion-panel expanded="true" class="filter-panel">
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon>attach_money</mat-icon>
          {{ language() === 'ar' ? 'نطاق السعر' : 'Price Range' }}
        </mat-panel-title>
      </mat-expansion-panel-header>

      <app-price-range-filter
        [language]="language()"
        [initialMin]="currentFilters().priceRange?.min || 0"
        [initialMax]="currentFilters().priceRange?.max || 1000"
        (rangeChange)="onPriceChange($event)">
      </app-price-range-filter>
    </mat-expansion-panel>

    <!-- Category Filter -->
    <mat-expansion-panel class="filter-panel">
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon>category</mat-icon>
          {{ language() === 'ar' ? 'الفئات' : 'Categories' }}
        </mat-panel-title>
      </mat-expansion-panel-header>
      <app-category-filter
        [language]="language()"
        [selectedCategoryIds]="currentFilters().categoryIds || []"
        (categoryChange)="onCategoryChange($event)" />
    </mat-expansion-panel>

    <!-- Brand Filter -->
    <mat-expansion-panel class="filter-panel">
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon>store</mat-icon>
          {{ language() === 'ar' ? 'العلامات التجارية' : 'Brands' }}
        </mat-panel-title>
      </mat-expansion-panel-header>
      <app-brand-filter
        [language]="language()"
        [selectedBrandIds]="currentFilters().brandIds || ''"
        (brandChange)="onBrandChange($event)" />
    </mat-expansion-panel>

    <!-- Rating Filter -->
    <mat-expansion-panel class="filter-panel">
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon>star</mat-icon>
          {{ language() === 'ar' ? 'التقييم' : 'Rating' }}
        </mat-panel-title>
      </mat-expansion-panel-header>
      <app-rating-filter
        [language]="language()"
        [selectedRatings]="currentFilters().ratings || []"
        (ratingsChange)="onRatingChange($event)" />
    </mat-expansion-panel>

    <!-- Availability Filter -->
    <mat-expansion-panel class="filter-panel">
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon>inventory</mat-icon>
          {{ language() === 'ar' ? 'التوفر' : 'Availability' }}
        </mat-panel-title>
      </mat-expansion-panel-header>
      <div class="filter-options">
        @for (option of availabilityOptions; track option.value) {
          <mat-checkbox
            class="filter-checkbox"
            [checked]="isAvailabilitySelected(option.value)"
            (change)="onAvailabilityChange(option.value, $event.checked)">
            {{ getLabel(option.label, option.labelAr) }}
          </mat-checkbox>
        }
      </div>
    </mat-expansion-panel>

  </mat-accordion>

  <!-- Apply Filters Button (Mobile) -->
  <div class="filter-actions mobile-only">
    <button
      mat-raised-button
      color="primary"
      class="apply-filters-btn">
      <mat-icon>done</mat-icon>
      {{ language() === 'ar' ? 'تطبيق التصفية' : 'Apply Filters' }}
    </button>
  </div>

</div>
