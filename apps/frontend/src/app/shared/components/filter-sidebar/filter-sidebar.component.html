<!-- Filter Sidebar Container -->
<div class="filter-sidebar" [attr.dir]="language() === 'ar' ? 'rtl' : 'ltr'">

  <!-- Header -->
  <div class="filter-header">
    <div class="filter-title">
      <mat-icon class="filter-icon">filter_list</mat-icon>
      <h3>{{ language() === 'ar' ? 'تصفية المنتجات' : 'Filter Products' }}</h3>
    </div>

    @if (hasActiveFilters()) {
      <button
        mat-button
        class="clear-all-btn"
        (click)="clearAll()">
        <mat-icon>clear_all</mat-icon>
        {{ language() === 'ar' ? 'مسح الكل' : 'Clear All' }}
      </button>
    }
  </div>

  <mat-divider></mat-divider>

  <!-- Active Filters Count Badge -->
  @if (activeFilterCount() > 0) {
    <div class="active-filters-badge">
      <mat-icon>check_circle</mat-icon>
      <span>
        {{ activeFilterCount() }} {{ language() === 'ar' ? 'تصفية نشطة' : 'Active Filters' }}
      </span>
    </div>
  }

  <!-- Filter Sections -->
  <mat-accordion class="filter-accordion">

    <!-- Price Range Filter -->
    <mat-expansion-panel expanded="true" class="filter-panel">
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon>attach_money</mat-icon>
          {{ language() === 'ar' ? 'نطاق السعر' : 'Price Range' }}
        </mat-panel-title>
      </mat-expansion-panel-header>

      <app-price-range-filter
        [language]="language()"
        [initialMin]="currentFilters().priceRange?.min || 0"
        [initialMax]="currentFilters().priceRange?.max || 1000"
        (rangeChange)="onPriceChange($event)">
      </app-price-range-filter>
    </mat-expansion-panel>

    <!-- Rating Filter -->
    <mat-expansion-panel expanded="true" class="filter-panel">
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon>star</mat-icon>
          {{ language() === 'ar' ? 'التقييم' : 'Customer Rating' }}
        </mat-panel-title>
      </mat-expansion-panel-header>

      <app-rating-filter
        [language]="language()"
        [selectedRatings]="currentFilters().ratings || []"
        (ratingsChange)="onRatingChange($event)">
      </app-rating-filter>
    </mat-expansion-panel>

    <!-- Authenticity Filter (Syrian Heritage) -->
    <mat-expansion-panel expanded="true" class="filter-panel authenticity-panel">
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon>verified</mat-icon>
          {{ language() === 'ar' ? 'الأصالة السورية' : 'Syrian Authenticity' }}
        </mat-panel-title>
      </mat-expansion-panel-header>

      <app-authenticity-filter
        [language]="language()"
        [selectedAuthenticity]="currentFilters().authenticity || {}"
        (authenticityChange)="onAuthenticityChange($event)">
      </app-authenticity-filter>
    </mat-expansion-panel>

    <!-- Availability Filter -->
    <mat-expansion-panel class="filter-panel">
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon>inventory_2</mat-icon>
          {{ language() === 'ar' ? 'التوفر' : 'Availability' }}
        </mat-panel-title>
      </mat-expansion-panel-header>

      <div class="filter-options">
        <mat-checkbox
          [checked]="isAvailabilitySelected('inStock')"
          (change)="onAvailabilityChange('inStock', $event.checked)"
          class="filter-checkbox">
          {{ language() === 'ar' ? 'متوفر' : 'In Stock' }}
        </mat-checkbox>

        <mat-checkbox
          [checked]="isAvailabilitySelected('outOfStock')"
          (change)="onAvailabilityChange('outOfStock', $event.checked)"
          class="filter-checkbox">
          {{ language() === 'ar' ? 'غير متوفر' : 'Out of Stock' }}
        </mat-checkbox>
      </div>
    </mat-expansion-panel>

    <!-- Syrian Regions Filter -->
    <mat-expansion-panel class="filter-panel">
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon>location_on</mat-icon>
          {{ language() === 'ar' ? 'المنطقة السورية' : 'Syrian Region' }}
        </mat-panel-title>
      </mat-expansion-panel-header>

      <div class="filter-options region-filter">
        @for (region of syrianRegions; track region.value) {
          <mat-checkbox
            [checked]="isRegionSelected(region.value)"
            (change)="onRegionChange(region.value, $event.checked)"
            class="filter-checkbox">
            {{ getLabel(region.label, region.labelAr) }}
          </mat-checkbox>
        }
      </div>
    </mat-expansion-panel>

  </mat-accordion>

  <!-- Apply Filters Button (Mobile) -->
  <div class="filter-actions mobile-only">
    <button
      mat-raised-button
      color="primary"
      class="apply-filters-btn">
      <mat-icon>done</mat-icon>
      {{ language() === 'ar' ? 'تطبيق التصفية' : 'Apply Filters' }}
    </button>
  </div>

</div>
