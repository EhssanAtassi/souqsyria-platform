<!-- SouqSyria Header Navigation Component -->
<!-- 4-Row Structure: TopBar | Main Header | Category Nav | Quick Access -->

<header class="sq-header" [class.rtl]="config.rtl" [attr.dir]="config.rtl ? 'rtl' : 'ltr'">

  <!-- ====================== ROW 1: TOP BAR ====================== -->
  <app-top-bar
    [config]="config"
    [user]="user"
    (languageChange)="onLanguageChange($event)"
    (linkClick)="onTopBarLinkClick($event)"
  ></app-top-bar>

  <!-- ====================== ROW 2: MAIN HEADER ====================== -->
  <div class="sq-main-header bg-surface border-b border-outline/30 shadow-sm">
    <div class="sq-container max-w-[1400px] mx-auto px-6">
      <div class="flex items-center h-[72px] gap-8">

        <!-- Mobile Menu Button -->
        <button
          class="lg:hidden text-on-surface-variant hover:text-primary-400 w-12 h-12 min-w-[48px] min-h-[48px] flex items-center justify-center rounded-lg transition-all duration-200"
          [class.bg-primary-50]="mobileMenuOpen"
          [class.text-primary-400]="mobileMenuOpen"
          (click)="toggleMobileMenu()"
          [attr.aria-label]="config.language === 'ar' ? (mobileMenuOpen ? 'إغلاق القائمة' : 'فتح القائمة') : (mobileMenuOpen ? 'Close menu' : 'Open menu')"
          [attr.aria-expanded]="mobileMenuOpen"
        >
          <mat-icon class="transition-transform duration-200" [class.rotate-90]="mobileMenuOpen">
            {{ mobileMenuOpen ? 'close' : 'menu' }}
          </mat-icon>
        </button>

        <app-logo></app-logo>

        <!-- Search Bar (Desktop) -->
        <app-search-bar
          class="sq-search--desktop flex-1 max-w-[640px]"
          [language]="config.language"
          [isRtl]="config.rtl"
          (searchSubmit)="onSearchSubmit($event)"
        ></app-search-bar>

        <!-- Location Selector (Desktop) -->
        <app-location-selector
          class="hidden lg:block"
          [selectedLocation]="selectedLocation"
          [locations]="filteredLocations"
          [language]="config.language"
          (locationChange)="onLocationSelect($event)"
        ></app-location-selector>

        <!-- Account Menu (Desktop) -->
        <app-account-menu
          class="hidden lg:block"
          [user]="user"
          [language]="config.language"
          (loginClick)="onLoginClick()"
          (logoutClick)="onLogoutClick()"
        ></app-account-menu>

        <!-- Favorites Button (Desktop) -->
        <app-favorites-button
          class="hidden lg:block"
          [count]="wishlistCount"
          [language]="config.language"
          (favoritesClick)="onWishlistClick()"
        ></app-favorites-button>

        <!-- Cart Button (Desktop) with Mini Cart Dropdown (SS-CART-010) -->
        <app-cart-button
          class="hidden lg:block"
          [itemCount]="cart.itemCount"
          [items]="cart.items || []"
          [subtotal]="cart.subtotal || 0"
          [language]="config.language"
          (cartClick)="onCartClick()"
          (removeItem)="onCartRemoveItem($event)"
        ></app-cart-button>

        <!-- Mobile Cart Button -->
        <button
          (click)="onCartClick()"
          class="lg:hidden sq-mobile-cart-btn relative text-on-surface-variant hover:text-primary-400"
          [attr.aria-label]="config.language === 'ar' ? 'سلة التسوق' : 'Shopping cart'"
          routerLink="/cart"
        >
          <mat-icon
            [matBadge]="cart.itemCount > 0 ? cart.itemCount.toString() : ''"
            matBadgeColor="accent"
            [matBadgeHidden]="cart.itemCount === 0"
            matBadgeSize="small"
            [matBadgeDescription]="config.language === 'ar' ? cart.itemCount + ' عناصر في السلة' : cart.itemCount + ' items in cart'"
          >
            shopping_cart
          </mat-icon>
        </button>

      </div>
    </div>
  </div>

  <!-- Mobile Search Bar -->
  <app-search-bar
    class="sq-search--mobile"
    [language]="config.language"
    [isRtl]="config.rtl"
    (searchSubmit)="onSearchSubmit($event)"
  ></app-search-bar>

  <!-- ====================== ROW 3: CATEGORY NAVIGATION ====================== -->
  <!-- Wrapped in relative container for dropdown mega menu positioning -->
  <div class="relative">
    <app-category-navigation
      [config]="config"
      [categories]="categories"
      [featuredCategories]="config.featuredCategories"
      [activeMegaMenu]="activeMegaMenu"
      (categoryClick)="onCategoryClick($event)"
      (megaMenuShow)="showMegaMenu($event)"
      (megaMenuHide)="hideMegaMenu()"
      (allCategoriesClick)="onCategoriesClick()"
      (specialOffersClick)="onCategoryClick(categories[0] || null)"
      (flashSaleClick)="onCategoryClick(categories[0] || null)"
    ></app-category-navigation>

    <!-- S1 Sprint Mega Menu — Dropdown Mode (hover on featured categories) -->
    <app-mega-menu
      [categories]="categoryTree()"
      [isOpen]="megaMenuDropdownOpen()"
      [displayMode]="'dropdown'"
      (categorySelected)="onMegaMenuCategorySelected($event)"
      (menuClosed)="onMegaMenuClosed()"
      (menuMouseEnter)="onDropdownMenuMouseEnter()"
      (menuMouseLeave)="onDropdownMenuMouseLeave()"
    ></app-mega-menu>
  </div>

  <!-- S1 Sprint Mega Menu — Overlay Mode (click "All Categories") -->
  <app-mega-menu
    [categories]="categoryTree()"
    [isOpen]="megaMenuOpen()"
    [displayMode]="'overlay'"
    (categorySelected)="onMegaMenuCategorySelected($event)"
    (menuClosed)="onMegaMenuClosed()"
  ></app-mega-menu>

  <!-- ====================== ROW 4: QUICK ACCESS ====================== -->
  <app-quick-access-row
    [config]="config"
    (itemClick)="onQuickAccessItemClick($event)"
  ></app-quick-access-row>

  <!-- Mobile Category Nav (S1 Sprint) -->
  <app-mobile-category-nav
    [categories]="categoryTree()"
    [isOpen]="mobileMenuOpen"
    [isLoading]="categoryTreeLoading()"
    (categorySelected)="onMobileCategorySelected($event)"
    (menuClosed)="closeMobileMenu()"
  ></app-mobile-category-nav>

</header>
