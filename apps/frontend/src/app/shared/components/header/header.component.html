<!-- SouqSyria Header Navigation Component -->
<!-- 4-Row Header Structure: TopBar (Row 1) + Main Header (Row 2) + Category Nav (Row 3) + Quick Access (Row 4) -->

<header class="sq-header" [class.rtl]="config.rtl" [attr.dir]="config.rtl ? 'rtl' : 'ltr'">

  <!-- ====================== ROW 1: TOP BAR ====================== -->
  <app-top-bar
    [config]="config"
    [user]="user"
    (languageChange)="onLanguageChange($event)"
    (linkClick)="onTopBarLinkClick($event)"
  ></app-top-bar>

  <!-- ====================== ROW 2: MAIN HEADER ====================== -->
  <!-- Prototype match: bg-surface, border-outline/30, shadow-sm, h-[72px], gap-8 -->
  <div class="sq-main-header bg-surface border-b border-outline/30 shadow-sm">
    <div class="sq-container max-w-[1400px] mx-auto px-6">
      <div class="flex items-center h-[72px] gap-8">

        <!-- Mobile Menu Button (Mobile/Tablet only) - 48px touch target per WCAG 2.2 -->
        <button
          class="lg:hidden text-on-surface-variant hover:text-primary-400 w-12 h-12 min-w-[48px] min-h-[48px] flex items-center justify-center rounded-lg transition-all duration-200"
          [class.bg-primary-50]="mobileMenuOpen"
          [class.text-primary-400]="mobileMenuOpen"
          (click)="toggleMobileMenu()"
          [attr.aria-label]="config.language === 'ar' ? (mobileMenuOpen ? 'إغلاق القائمة' : 'فتح القائمة') : (mobileMenuOpen ? 'Close menu' : 'Open menu')"
          [attr.aria-expanded]="mobileMenuOpen"
        >
          <mat-icon class="transition-transform duration-200" [class.rotate-90]="mobileMenuOpen">
            {{ mobileMenuOpen ? 'close' : 'menu' }}
          </mat-icon>
        </button>

        <!-- Logo Component -->
        <app-logo></app-logo>

        <!-- Search Bar Component (Desktop) -->
        <app-search-bar
          class="sq-search--desktop flex-1 max-w-[640px]"
          [language]="config.language"
          [isRtl]="config.rtl"
          (searchSubmit)="onSearchSubmit($event)"
        ></app-search-bar>

        <!-- Location Selector Component (Desktop) -->
        <app-location-selector
          class="hidden lg:block"
          [selectedLocation]="selectedLocation"
          [locations]="filteredLocations"
          [language]="config.language"
          (locationChange)="onLocationSelect($event)"
        ></app-location-selector>

        <!-- Account Menu Component (Desktop) -->
        <app-account-menu
          class="hidden lg:block"
          [user]="user"
          [language]="config.language"
          (loginClick)="onLoginClick()"
          (logoutClick)="onLogoutClick()"
        ></app-account-menu>

        <!-- Favorites Button Component (Desktop) -->
        <app-favorites-button
          class="hidden lg:block"
          [count]="wishlistCount"
          [language]="config.language"
          (favoritesClick)="onWishlistClick()"
        ></app-favorites-button>

        <!-- Cart Button Component (Desktop) -->
        <app-cart-button
          class="hidden lg:block"
          [itemCount]="cart.itemCount"
          [language]="config.language"
          (cartClick)="onCartClick()"
        ></app-cart-button>

        <!-- Mobile Cart Button -->
        <button
          (click)="onCartClick()"
          class="lg:hidden sq-mobile-cart-btn relative text-on-surface-variant hover:text-primary-400"
          [attr.aria-label]="config.language === 'ar' ? 'سلة التسوق' : 'Shopping cart'"
          routerLink="/cart"
        >
          <mat-icon
            [matBadge]="cart.itemCount > 0 ? cart.itemCount.toString() : ''"
            matBadgeColor="accent"
            [matBadgeHidden]="cart.itemCount === 0"
            matBadgeSize="small"
          >
            shopping_cart
          </mat-icon>
        </button>

      </div>
    </div>
  </div>

  <!-- Mobile Search Bar (shown below main header on mobile/tablet) -->
  <app-search-bar
    class="sq-search--mobile"
    [language]="config.language"
    [isRtl]="config.rtl"
    (searchSubmit)="onSearchSubmit($event)"
  ></app-search-bar>

  <!-- ====================== ROW 3: CATEGORY NAVIGATION ====================== -->
  <app-category-navigation
    [config]="config"
    [categories]="categories"
    [featuredCategories]="config.featuredCategories"
    [activeMegaMenu]="activeMegaMenu"
    (categoryClick)="onCategoryClick($event)"
    (megaMenuShow)="showMegaMenu($event)"
    (megaMenuHide)="hideMegaMenu()"
    (allCategoriesClick)="onCategoriesClick()"
    (specialOffersClick)="onCategoryClick(categories[0] || null)"
    (flashSaleClick)="onCategoryClick(categories[0] || null)"
  ></app-category-navigation>

  <!-- ====================== MEGA MENU (S1 Categories Sprint) ====================== -->
  <app-mega-menu
    [categories]="categoryTree()"
    [isOpen]="megaMenuOpen()"
    (categorySelected)="onMegaMenuCategorySelected($event)"
    (menuClosed)="onMegaMenuClosed()"
  ></app-mega-menu>

  <!-- ====================== ROW 4: QUICK ACCESS ====================== -->
  <app-quick-access-row
    [config]="config"
    (itemClick)="onQuickAccessItemClick($event)"
  ></app-quick-access-row>

  <!-- Mobile Category Menu (Legacy - Can be removed in future sprint) -->
  <div class="sq-mobile-menu-wrapper" [class.sq-mobile-menu-open]="mobileMenuOpen">
    <app-mobile-category-menu
      [categories]="categories"
      [config]="config"
      [user]="user"
      [locations]="filteredLocations"
      [isOpen]="mobileMenuOpen"
      [selectedLocation]="selectedLocation"
      (categoryClick)="onCategoryClick($event)"
      (subcategoryClick)="onSubcategoryClick($event)"
      (menuClose)="closeMobileMenu()"
      (loginClick)="onLoginClick()"
      (logoutClick)="onLogoutClick()"
      (locationChange)="onLocationSelect($event)"
      (languageChange)="onLanguageChange($event)"
      (promotionalLinkClick)="onPromotionalLinkClick($event)"
    ></app-mobile-category-menu>
  </div>

  <!-- Mobile Category Nav (S3 Categories Sprint) -->
  <app-mobile-category-nav
    [categories]="categoryTree()"
    [isOpen]="mobileMenuOpen"
    [isLoading]="categoryTreeLoading()"
    (categorySelected)="onMobileCategorySelected($event)"
    (menuClosed)="closeMobileMenu()"
  ></app-mobile-category-nav>

</header>
