<!-- SouqSyria Header Navigation Component -->
<!-- Responsive navigation header with search, user actions, and category navigation -->

<header class="sq-header" [class.rtl]="config.rtl" [attr.dir]="config.rtl ? 'rtl' : 'ltr'">
  
  <!-- Main Header Bar -->
  <mat-toolbar class="sq-main-header bg-white border-b border-gray-200 shadow-sm">
    <div class="sq-container flex items-center justify-between w-full py-2">
      
      <!-- Mobile Menu Button & Logo Section -->
      <div class="flex items-center space-x-4 rtl:space-x-reverse">
        <!-- Mobile Menu Toggle -->
        <button 
          mat-icon-button 
          class="lg:hidden text-neutral-700 hover:text-primary-600 w-10 h-10 flex items-center justify-center rounded-lg transition-all duration-200"
          [class.bg-primary-50]="mobileMenuOpen"
          [class.text-primary-600]="mobileMenuOpen"
          (click)="toggleMobileMenu()"
          [attr.aria-label]="config.language === 'ar' ? (mobileMenuOpen ? 'Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©' : 'ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©') : (mobileMenuOpen ? 'Close menu' : 'Open menu')"
          [attr.aria-expanded]="mobileMenuOpen"
        >
          <mat-icon class="transition-transform duration-200" [class.rotate-90]="mobileMenuOpen">
            {{ mobileMenuOpen ? 'close' : 'menu' }}
          </mat-icon>
        </button>
        
        <!-- Logo -->
        <div class="sq-logo flex items-center cursor-pointer" routerLink="/">
          <div class="flex items-center space-x-2 rtl:space-x-reverse">
            <div class="w-10 h-10 bg-gradient-to-br from-primary-500 to-primary-600 rounded-lg flex items-center justify-center">
              <mat-icon class="text-white text-xl">storefront</mat-icon>
            </div>
            <div class="hidden sm:block">
              <h1 class="text-xl font-display font-bold text-primary-700">SouqSyria</h1>
              <p class="text-xs text-neutral-500 -mt-1">
                {{ config.language === 'ar' ? 'Ø³ÙˆÙ‚ Ø³ÙˆØ±ÙŠØ§' : 'Syrian Marketplace' }}
              </p>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Search Section -->
      <div class="flex-1 max-w-3xl mx-4 lg:mx-8 hidden lg:block">
        <form [formGroup]="searchForm" (ngSubmit)="onSearchSubmit($event)" class="sq-search-form">
          <div class="flex bg-gray-50 rounded-lg border border-gray-200 focus-within:border-primary-500 focus-within:ring-2 focus-within:ring-primary-200">
            
            <!-- Category Selector -->
            <div class="flex-shrink-0 w-40 border-r border-gray-300">
              <mat-form-field appearance="fill" class="sq-category-select w-full bg-transparent border-none">
                <mat-select 
                  formControlName="category" 
                  [placeholder]="config.language === 'ar' ? 'Ø§Ù„ÙØ¦Ø©' : 'Category'"
                  class="text-sm"
                >
                <mat-option value="all">
                  {{ config.language === 'ar' ? 'Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ¦Ø§Øª' : 'All Categories' }}
                </mat-option>
                <mat-option 
                  *ngFor="let category of categories; trackBy: trackByCategory" 
                  [value]="category.id"
                >
                  {{ getCategoryText(category) }}
                </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            
            <!-- Search Input -->
            <div class="flex-1 relative">
              <input
                #searchInput
                type="text"
                formControlName="query"
                [placeholder]="config.language === 'ar' ? 'Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª...' : 'Search for products...'"
                class="w-full px-4 py-3 bg-transparent text-neutral-900 placeholder-neutral-500 focus:outline-none"
                [attr.dir]="config.rtl ? 'rtl' : 'ltr'"
              />
              
              <!-- Search Suggestions Dropdown -->
              <div 
                *ngIf="searchSuggestions.length > 0" 
                class="absolute top-full left-0 right-0 bg-white shadow-lg rounded-b-lg border border-t-0 border-gray-200 z-50 max-h-64 overflow-y-auto"
                role="listbox"
                [attr.aria-label]="config.language === 'ar' ? 'Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø§Ù„Ø¨Ø­Ø«' : 'Search suggestions'"
              >
                <div 
                  *ngFor="let suggestion of searchSuggestions; index as i; trackBy: trackBySuggestion"
                  class="px-4 py-2 hover:bg-gray-50 focus:bg-primary-50 cursor-pointer text-sm text-neutral-700 focus:outline-none"
                  (click)="selectSuggestion(suggestion, i)"
                  (keydown)="handleSuggestionKeydown($event, suggestion, i)"
                  [tabindex]="selectedSuggestionIndex === i ? 0 : -1"
                  role="option"
                  [attr.aria-selected]="selectedSuggestionIndex === i"
                  [attr.id]="'suggestion-' + i"
                  [class.bg-primary-50]="selectedSuggestionIndex === i"
                >
                  <mat-icon class="text-neutral-400 text-sm mr-2 rtl:mr-0 rtl:ml-2">search</mat-icon>
                  {{ suggestion }}
                </div>
              </div>
            </div>
            
            <!-- Search Button -->
            <button 
              type="submit"
              mat-icon-button 
              class="sq-search-btn text-white bg-primary-600 hover:bg-primary-700 rounded-r-lg px-4 min-w-[3rem]"
              [attr.aria-label]="config.language === 'ar' ? 'Ø¨Ø­Ø«' : 'Search'"
            >
              <mat-icon>search</mat-icon>
            </button>
          </div>
        </form>
      </div>
      
      <!-- Right Actions -->
      <div class="flex items-center space-x-4 rtl:space-x-reverse">
        
        <!-- Location Selector -->
        <div class="hidden lg:flex items-center">
          <button 
            mat-button 
            [matMenuTriggerFor]="locationMenu"
            class="sq-location-btn text-neutral-700 hover:text-primary-600"
          >
            <mat-icon class="mr-1 rtl:mr-0 rtl:ml-1">location_on</mat-icon>
            <span class="text-sm">{{ getCurrentLocationText() }}</span>
            <mat-icon class="ml-1 rtl:ml-0 rtl:mr-1">expand_more</mat-icon>
          </button>
          
          <!-- Location Menu -->
          <mat-menu #locationMenu="matMenu" class="sq-location-menu">
            <div class="px-4 py-2 border-b border-gray-200">
              <h4 class="font-medium text-neutral-900">
                {{ config.language === 'ar' ? 'Ø§Ø®ØªØ± Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªÙˆØµÙŠÙ„' : 'Select Delivery Location' }}
              </h4>
            </div>
            <button 
              mat-menu-item 
              *ngFor="let location of filteredLocations; trackBy: trackByLocation"
              (click)="onLocationSelect(location)"
              [class.bg-primary-50]="selectedLocation?.id === location.id"
            >
              <mat-icon 
                class="mr-2 rtl:mr-0 rtl:ml-2"
                [class.text-primary-600]="selectedLocation?.id === location.id"
              >
                {{ selectedLocation?.id === location.id ? 'radio_button_checked' : 'radio_button_unchecked' }}
              </mat-icon>
              <span>{{ config.language === 'ar' ? location.nameAr : location.name }}</span>
              <mat-icon 
                *ngIf="!location.deliveryAvailable" 
                class="ml-auto text-red-500 rtl:ml-0 rtl:mr-auto"
              >
                warning
              </mat-icon>
            </button>
          </mat-menu>
        </div>
        
        <!-- User Account Section -->
        <div class="flex items-center">
          <ng-container *ngIf="!user.isLoggedIn; else loggedInUser">
            <!-- Login/Register Button -->
            <button 
              mat-button 
              (click)="onLoginClick()"
              class="sq-login-btn text-neutral-700 hover:text-primary-600"
            >
              <mat-icon class="mr-1 rtl:mr-0 rtl:ml-1">account_circle</mat-icon>
              <span class="hidden sm:inline">
                {{ config.language === 'ar' ? 'Ø¯Ø®ÙˆÙ„ / ØªØ³Ø¬ÙŠÙ„' : 'Sign In / Register' }}
              </span>
            </button>
          </ng-container>
          
          <!-- Logged In User Menu -->
          <ng-template #loggedInUser>
            <button 
              mat-button 
              [matMenuTriggerFor]="userMenu"
              class="sq-user-btn flex items-center text-neutral-700 hover:text-primary-600"
            >
              <div class="w-8 h-8 bg-primary-600 rounded-full flex items-center justify-center mr-2 rtl:mr-0 rtl:ml-2">
                <mat-icon class="text-white text-sm">person</mat-icon>
              </div>
              <div class="hidden lg:block text-left rtl:text-right">
                <p class="text-sm font-medium">{{ user.name || 'User' }}</p>
                <p class="text-xs text-neutral-500">
                  {{ config.language === 'ar' ? 'Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ' : 'Welcome back' }}
                </p>
              </div>
              <mat-icon class="ml-1 rtl:ml-0 rtl:mr-1">expand_more</mat-icon>
            </button>
            
            <!-- User Menu -->
            <mat-menu #userMenu="matMenu" class="sq-user-menu">
              <button mat-menu-item>
                <mat-icon class="mr-2 rtl:mr-0 rtl:ml-2">person</mat-icon>
                {{ config.language === 'ar' ? 'Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ' : 'My Profile' }}
              </button>
              <button mat-menu-item>
                <mat-icon class="mr-2 rtl:mr-0 rtl:ml-2">shopping_bag</mat-icon>
                {{ config.language === 'ar' ? 'Ø·Ù„Ø¨Ø§ØªÙŠ' : 'My Orders' }}
              </button>
              <button mat-menu-item>
                <mat-icon class="mr-2 rtl:mr-0 rtl:ml-2">favorite</mat-icon>
                {{ config.language === 'ar' ? 'Ø§Ù„Ù…ÙØ¶Ù„Ø©' : 'Wishlist' }}
              </button>
              <mat-divider></mat-divider>
              <button mat-menu-item (click)="onLogoutClick()">
                <mat-icon class="mr-2 rtl:mr-0 rtl:ml-2 text-red-600">logout</mat-icon>
                <span class="text-red-600">{{ config.language === 'ar' ? 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬' : 'Sign Out' }}</span>
              </button>
            </mat-menu>
          </ng-template>
        </div>
        
        <!-- Shopping Cart -->
        <button 
          mat-icon-button 
          (click)="onCartClick()"
          class="sq-cart-btn relative text-neutral-700 hover:text-primary-600"
          [attr.aria-label]="config.language === 'ar' ? 'Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚' : 'Shopping cart'"
        >
          <mat-icon
            [matBadge]="cart.itemCount > 0 ? cart.itemCount.toString() : ''"
            matBadgeColor="accent"
            [matBadgeHidden]="cart.itemCount === 0"
            matBadgeSize="small"
            aria-hidden="false"
          >
            shopping_cart
          </mat-icon>
        </button>
        
        <!-- Language Toggle -->
        <div 
          *ngIf="config.showArabic"
          class="sq-language-toggle hidden md:flex rounded-lg overflow-hidden border border-gray-300"
          [attr.aria-label]="config.language === 'ar' ? 'Ø§Ø®ØªØ± Ø§Ù„Ù„ØºØ©' : 'Select language'"
        >
          <button 
            type="button"
            (click)="onLanguageChange('en')"
            class="sq-lang-btn px-3 py-2 text-xs font-medium transition-all duration-200 flex items-center gap-1"
            [class]="config.language === 'en' ? 'bg-primary-600 text-white' : 'bg-white text-neutral-600 hover:bg-gray-50'"
            [attr.aria-label]="config.language === 'ar' ? 'Ø§Ù„Ø§Ù†Ø¬Ù„ÙŠØ²ÙŠØ©' : 'English'"
            [attr.aria-pressed]="config.language === 'en'"
          >
            <span>ğŸ‡ºğŸ‡¸</span>
            EN
          </button>
          <button 
            type="button"
            (click)="onLanguageChange('ar')"
            class="sq-lang-btn px-3 py-2 text-xs font-medium transition-all duration-200 flex items-center gap-1 border-l border-gray-300"
            [class]="config.language === 'ar' ? 'bg-primary-600 text-white' : 'bg-white text-neutral-600 hover:bg-gray-50'"
            [attr.aria-label]="config.language === 'ar' ? 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©' : 'Arabic'"
            [attr.aria-pressed]="config.language === 'ar'"
          >
            <span>ğŸ‡¸ğŸ‡¾</span>
            Ø¹Ø±
          </button>
        </div>
      </div>
    </div>
  </mat-toolbar>
  
  <!-- Mobile Search Bar (shown below main header on mobile and tablet) -->
  <div class="lg:hidden bg-gray-50 border-b border-gray-200 px-4 py-3">
    <form [formGroup]="searchForm" (ngSubmit)="onSearchSubmit($event)">
      <div class="flex bg-white rounded-lg border border-gray-200 focus-within:border-primary-500">
        <input
          type="text"
          formControlName="query"
          [placeholder]="config.language === 'ar' ? 'Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª...' : 'Search products...'"
          class="flex-1 px-4 py-2 bg-transparent text-neutral-900 placeholder-neutral-500 focus:outline-none rounded-l-lg"
        />
        <button 
          type="submit"
          mat-icon-button 
          class="text-white bg-primary-600 rounded-r-lg"
        >
          <mat-icon>search</mat-icon>
        </button>
      </div>
    </form>
  </div>

  <!-- Brand Color Separator Line Between Header and Category Navigation -->
  <div class="sq-colorful-separator h-1 w-full flex">
    <div class="flex-1 bg-gradient-to-r from-amber-600 to-amber-500"></div>
    <div class="flex-1 bg-gradient-to-r from-amber-500 to-orange-500"></div>
    <div class="flex-1 bg-gradient-to-r from-orange-500 to-orange-600"></div>
    <div class="flex-1 bg-gradient-to-r from-orange-600 to-amber-700"></div>
    <div class="flex-1 bg-gradient-to-r from-amber-700 to-yellow-600"></div>
    <div class="flex-1 bg-gradient-to-r from-yellow-600 to-amber-600"></div>
    <div class="flex-1 bg-gradient-to-r from-amber-600 to-orange-500"></div>
    <div class="flex-1 bg-gradient-to-r from-orange-500 to-amber-600"></div>
  </div>

  <!-- Category Navigation (Desktop) -->
  <app-category-navigation
    [config]="config"
    [categories]="categories"
    [featuredCategories]="config.featuredCategories"
    [activeMegaMenu]="activeMegaMenu"
    (categoryClick)="onCategoryClick($event)"
    (megaMenuShow)="showMegaMenu($event)"
    (megaMenuHide)="hideMegaMenu()"
    (allCategoriesClick)="onCategoryClick(categories[0] || null)"
    (specialOffersClick)="onCategoryClick(categories[0] || null)"
    (flashSaleClick)="onCategoryClick(categories[0] || null)"
  ></app-category-navigation>
  
  <!-- Mega Menu Overlay (for hover effects) -->
  <div 
    *ngIf="activeMegaMenu"
    class="sq-mega-menu-overlay fixed top-0 left-0 w-full h-full bg-black bg-opacity-20 z-40"
    (click)="hideMegaMenu()"
  ></div>
  
  <!-- Mobile Category Menu -->
  <div class="sq-mobile-menu-wrapper" [class.sq-mobile-menu-open]="mobileMenuOpen">
    <app-mobile-category-menu
      [categories]="categories"
      [config]="config"
      [user]="user"
      [locations]="filteredLocations"
      [isOpen]="mobileMenuOpen"
      [selectedLocation]="selectedLocation"
      (categoryClick)="onCategoryClick($event)"
      (subcategoryClick)="onSubcategoryClick($event)"
      (menuClose)="closeMobileMenu()"
      (loginClick)="onLoginClick()"
      (logoutClick)="onLogoutClick()"
      (locationChange)="onLocationSelect($event)"
      (languageChange)="onLanguageChange($event)"
      (promotionalLinkClick)="onPromotionalLinkClick($event)"
    ></app-mobile-category-menu>
  </div>
  
</header>