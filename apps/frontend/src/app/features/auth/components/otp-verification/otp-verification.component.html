<!-- OTP Verification Component Template for SouqSyria marketplace -->
<div class="auth-page">
  <div class="auth-card">
    <div class="auth-brand-mark">
      <div class="auth-brand-icon"><span>ุณ</span></div>
    </div>
    <div class="auth-header">
      <h1>{{ 'auth.otp.title' | translate }}</h1>
      <p>{{ 'auth.otp.subtitle' | translate }}</p>
    </div>

    @if (otpEmail()) {
      <div class="email-display">
        {{ 'auth.otp.codeSentTo' | translate }}
        <strong>{{ otpEmail() }}</strong>
      </div>
    }

    @if (error()) {
      <div class="error-message" role="alert" aria-live="polite">
        {{ error() }}
      </div>
    }

    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      <!-- OTP code field -->
      <mat-form-field appearance="outline" class="otp-input">
        <mat-label>{{ 'auth.otp.codeLabel' | translate }}</mat-label>
        <input
          matInput
          formControlName="otpCode"
          type="text"
          maxlength="6"
          autocomplete="one-time-code"
          inputmode="numeric"
          placeholder="000000"
        />
        <mat-icon matSuffix aria-hidden="true">lock</mat-icon>
        @if (form.get('otpCode')?.hasError('required') && form.get('otpCode')?.touched) {
          <mat-error>{{ 'auth.validation.otpRequired' | translate }}</mat-error>
        }
        @if (form.get('otpCode')?.hasError('otpFormat') && form.get('otpCode')?.touched) {
          <mat-error>{{ 'auth.validation.otpFormat' | translate }}</mat-error>
        }
      </mat-form-field>

      <!-- Submit button -->
      <button
        mat-raised-button
        color="primary"
        class="submit-btn"
        type="submit"
        [disabled]="form.invalid || isLoading()"
      >
        @if (isLoading()) {
          <mat-spinner diameter="24"></mat-spinner>
        } @else {
          {{ 'auth.otp.submit' | translate }}
        }
      </button>
    </form>

    <!-- OTP validity timer (10 minutes) -->
    @if (otpValidityCountdown() > 0) {
      <div class="otp-validity-timer">
        <mat-icon class="timer-icon" aria-hidden="true">timer</mat-icon>
        <span>
          {{ 'auth.otp.validFor' | translate }}
          <strong>{{ formatTime(otpValidityCountdown()) }}</strong>
        </span>
      </div>
    } @else {
      <div class="otp-validity-timer expired">
        <mat-icon class="timer-icon" aria-hidden="true">timer_off</mat-icon>
        <span>{{ 'auth.otp.expired' | translate }}</span>
      </div>
    }

    <!-- Resend section with countdown -->
    <div class="resend-section">
      @if (countdown() > 0) {
        <span>
          {{ 'auth.otp.resendIn' | translate }}
          <span class="countdown">{{ countdown() }}s</span>
        </span>
      } @else {
        <button
          mat-button
          class="resend-btn"
          (click)="resendOtp()"
          [disabled]="isLoading()"
        >
          {{ 'auth.otp.resendButton' | translate }}
        </button>
      }
    </div>

    <!-- Footer -->
    <div class="auth-footer">
      <a routerLink="/auth/register">{{ 'auth.otp.backToRegister' | translate }}</a>
    </div>
  </div>
</div>
