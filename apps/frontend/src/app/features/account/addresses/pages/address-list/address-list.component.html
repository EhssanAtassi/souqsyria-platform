<div class="address-list-container">
  <!-- Page Header -->
  <div class="page-header">
    <h1 class="page-title">{{ 'addresses.title' | translate }}</h1>
    <button
      mat-raised-button
      color="primary"
      (click)="onAddNewAddress()"
      *ngIf="!showForm()"
      [attr.aria-label]="'addresses.addNew' | translate"
    >
      <mat-icon>add</mat-icon>
      {{ 'addresses.addNew' | translate }}
    </button>
  </div>

  <!-- Loading State - P1 #6 FIX: Added aria-live for screen readers -->
  <div class="loading-container" *ngIf="isLoading() && isEmpty()" aria-live="polite" aria-busy="true">
    <mat-spinner diameter="50" [attr.aria-label]="'addresses.loadingAddresses' | translate"></mat-spinner>
    <p>{{ 'addresses.loadingAddresses' | translate }}</p>
  </div>

  <!-- Address Form (Create/Edit) -->
  <div class="form-section" *ngIf="showForm()">
    <app-address-form
      [address]="editingAddress()"
      [mode]="formMode()"
      (saved)="onFormSaved()"
      (cancelled)="onFormCancelled()"
    />
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="isEmpty() && !isLoading() && !showForm()" role="region" [attr.aria-label]="'addresses.noAddresses' | translate">
    <mat-icon class="empty-icon" aria-hidden="true">location_off</mat-icon>
    <h2>{{ 'addresses.noAddresses' | translate }}</h2>
    <p>{{ 'addresses.noAddressesDesc' | translate }}</p>
    <button
      mat-raised-button
      color="primary"
      (click)="onAddNewAddress()"
      [attr.aria-label]="'addresses.addNew' | translate"
    >
      <mat-icon aria-hidden="true">add</mat-icon>
      {{ 'addresses.addNew' | translate }}
    </button>
  </div>

  <!-- Address Cards Grid - P1 #6 FIX: Added role="list" for screen readers -->
  <div class="address-grid" *ngIf="!isEmpty() && !showForm()" role="list" [attr.aria-label]="'addresses.title' | translate">
    <mat-card
      *ngFor="let address of addresses(); trackBy: trackByAddressId"
      class="address-card"
      role="listitem"
      [attr.aria-label]="'Address: ' + address.fullName + ', ' + getFullAddress(address)"
    >
      <!-- Card Header -->
      <mat-card-header>
        <div class="card-header-content">
          <!-- Label Badge -->
          <div class="label-badge">
            <mat-icon>{{ getLabelIcon(address.label) }}</mat-icon>
            <span>{{ 'addresses.label' + (address.label || 'other' | titlecase) | translate }}</span>
          </div>

          <!-- Default Badge -->
          <div class="default-badge" *ngIf="address.isDefault">
            <mat-icon>star</mat-icon>
            <span>{{ 'addresses.defaultAddress' | translate }}</span>
          </div>
        </div>
      </mat-card-header>

      <!-- Card Content -->
      <mat-card-content>
        <div class="address-info">
          <!-- Full Name -->
          <div class="info-row">
            <mat-icon class="info-icon">person</mat-icon>
            <span class="info-text">{{ address.fullName }}</span>
          </div>

          <!-- Phone -->
          <div class="info-row">
            <mat-icon class="info-icon">phone</mat-icon>
            <span class="info-text">{{ address.phone }}</span>
          </div>

          <!-- Full Address -->
          <div class="info-row">
            <mat-icon class="info-icon">location_on</mat-icon>
            <span class="info-text">{{ getFullAddress(address) }}</span>
          </div>

          <!-- Building & Floor -->
          <div class="info-row" *ngIf="address.building || address.floor">
            <mat-icon class="info-icon">apartment</mat-icon>
            <span class="info-text">{{ getBuildingFloorInfo(address) }}</span>
          </div>

          <!-- Additional Details -->
          <div class="info-row" *ngIf="address.additionalDetails">
            <mat-icon class="info-icon">notes</mat-icon>
            <span class="info-text additional-details">{{ address.additionalDetails }}</span>
          </div>
        </div>
      </mat-card-content>

      <!-- Card Actions - P1 #6 FIX: Added aria-labels for action buttons -->
      <mat-card-actions>
        <button
          mat-button
          color="primary"
          (click)="onEditAddress(address)"
          [attr.aria-label]="('addresses.editAddress' | translate) + ' - ' + address.fullName"
        >
          <mat-icon aria-hidden="true">edit</mat-icon>
          {{ 'addresses.editAddress' | translate }}
        </button>

        <button
          mat-button
          color="accent"
          (click)="onSetDefault(address)"
          *ngIf="!address.isDefault"
          [attr.aria-label]="('addresses.setDefault' | translate) + ' - ' + address.fullName"
        >
          <mat-icon aria-hidden="true">star_border</mat-icon>
          {{ 'addresses.setDefault' | translate }}
        </button>

        <button
          mat-button
          color="warn"
          (click)="onDeleteAddress(address)"
          [attr.aria-label]="('addresses.delete' | translate) + ' - ' + address.fullName"
        >
          <mat-icon aria-hidden="true">delete</mat-icon>
          {{ 'addresses.delete' | translate }}
        </button>
      </mat-card-actions>
    </mat-card>
  </div>
</div>
