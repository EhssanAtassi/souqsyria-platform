<!-- Mobile Category Navigation Overlay -->
<div
  *ngIf="isOpen"
  class="mobile-nav-backdrop fixed inset-0 z-50 bg-black/50 dark:bg-black/70 backdrop-blur-sm touch-none"
  (click)="onBackdropClick($event)"
  [@fadeIn]
  role="dialog"
  aria-modal="true"
  [attr.aria-label]="isRtl ? 'قائمة التصنيفات' : 'Categories menu'"
>
  <!-- Mobile Navigation Panel -->
  <div
    class="mobile-nav-panel fixed top-0 bottom-0 w-[85%] max-w-sm bg-white dark:bg-gray-900 shadow-2xl overflow-y-auto ltr:right-0 ltr:rounded-l-lg rtl:left-0 rtl:rounded-r-lg"
    [@slideIn]="!isRtl ? 'open' : ''"
    [@slideInRtl]="isRtl ? 'open' : ''"
    (click)="$event.stopPropagation()"
    role="navigation"
  >
    <!-- Header -->
    <div
      class="sticky top-0 z-10 bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 px-4 py-3 flex items-center gap-2 rtl:flex-row-reverse"
    >
      <!-- Back Button (shown when in drill-down mode) -->
      <button
        *ngIf="isInDrillDown()"
        type="button"
        class="p-2 -m-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 active:bg-gray-200 dark:active:bg-gray-700 transition-colors duration-200 touch-manipulation"
        (click)="goBack()"
        [attr.aria-label]="isRtl ? 'رجوع إلى المستوى السابق' : 'Back to previous level'"
      >
        <mat-icon class="text-gray-700 dark:text-gray-200 w-6 h-6 ltr:rotate-0 rtl:rotate-180">
          arrow_back
        </mat-icon>
      </button>

      <!-- Title -->
      <h2
        class="text-lg font-semibold text-gray-900 dark:text-white flex-1 truncate ltr:text-left rtl:text-right"
      >
        <ng-container *ngIf="!isInDrillDown()">
          {{ isRtl ? 'التصنيفات' : 'Categories' }}
        </ng-container>
        <ng-container *ngIf="isInDrillDown() && currentParent()">
          {{ getCategoryName(currentParent()!) }}
        </ng-container>
      </h2>

      <!-- Close Button -->
      <button
        type="button"
        class="p-2 -m-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 active:bg-gray-200 dark:active:bg-gray-700 transition-colors duration-200 touch-manipulation flex-shrink-0"
        (click)="closeMenu()"
        [attr.aria-label]="isRtl ? 'إغلاق قائمة التصنيفات' : 'Close categories menu'"
      >
        <mat-icon class="text-gray-700 dark:text-gray-200 w-6 h-6">close</mat-icon>
      </button>
    </div>

    <!-- Loading Skeleton -->
    <div *ngIf="isLoading" class="p-4 space-y-3" role="status" [attr.aria-label]="isRtl ? 'جاري التحميل' : 'Loading categories'">
      <div
        *ngFor="let item of skeletonItems(); trackBy: trackById"
        class="h-14 bg-gray-200 dark:bg-gray-700 rounded-lg animate-pulse"
      ></div>
      <span class="sr-only">{{ isRtl ? 'جاري تحميل التصنيفات...' : 'Loading categories...' }}</span>
    </div>

    <!-- Category List (Drill-down approach) -->
    <div
      *ngIf="!isLoading && currentCategories().length > 0"
      class="category-list"
      [@fadeIn]
    >
      <!-- Category Items -->
      <button
        *ngFor="let category of currentCategories(); trackBy: trackById"
        type="button"
        class="w-full flex items-center gap-3 px-4 py-4 min-h-[56px] hover:bg-gray-50 dark:hover:bg-gray-800 active:bg-gray-100 dark:active:bg-gray-700 transition-colors duration-200 border-b border-gray-100 dark:border-gray-700 touch-manipulation rtl:flex-row-reverse"
        matRipple
        (click)="hasChildren(category) ? drillInto(category) : onCategoryClick(category.slug)"
        [attr.aria-label]="getCategoryName(category) + (hasChildren(category) ? (isRtl ? ' - لديه فئات فرعية' : ' - has subcategories') : '')"
      >
        <!-- Category Icon -->
        <mat-icon
          *ngIf="category.icon"
          class="text-primary-600 dark:text-primary-400 flex-shrink-0 w-6 h-6"
        >
          {{ category.icon }}
        </mat-icon>

        <!-- Category Name -->
        <span
          class="font-medium text-gray-900 dark:text-white flex-1 ltr:text-left rtl:text-right"
        >
          {{ getCategoryName(category) }}
        </span>

        <!-- Chevron for categories with children -->
        <mat-icon
          *ngIf="hasChildren(category)"
          class="text-gray-400 dark:text-gray-500 flex-shrink-0 w-5 h-5 ltr:rotate-0 rtl:rotate-180"
        >
          chevron_right
        </mat-icon>
      </button>
    </div>

    <!-- Empty State -->
    <div
      *ngIf="!isLoading && currentCategories().length === 0"
      class="flex flex-col items-center justify-center py-16 px-6 text-center animate-fade-in"
      [@fadeIn]
      role="status"
    >
      <mat-icon class="text-gray-300 dark:text-gray-600 mb-4" style="font-size: 64px; width: 64px; height: 64px;">
        category
      </mat-icon>
      <p class="text-gray-600 dark:text-gray-300 font-medium text-base">
        {{ isRtl ? 'لا توجد تصنيفات متاحة' : 'No categories available' }}
      </p>
      <p class="text-gray-400 dark:text-gray-500 text-sm mt-2">
        {{ isRtl ? 'يرجى المحاولة مرة أخرى لاحقاً' : 'Please try again later' }}
      </p>
    </div>
  </div>
</div>
