<div class="review-list" [class.rtl]="language() === 'ar'">
  <!-- Header with Write Review button and Sort dropdown -->
  <div class="review-list__header">
    <button
      mat-raised-button
      color="primary"
      class="header__write-btn"
      (click)="onWriteReview()"
    >
      <mat-icon>rate_review</mat-icon>
      <span>{{ writeReviewLabel }}</span>
    </button>

    <mat-form-field class="header__sort" appearance="outline">
      <mat-label>{{ sortLabel }}</mat-label>
      <mat-select
        [value]="sortBy()"
        (selectionChange)="onSortChange($event.value)"
      >
        @for (option of sortOptions; track option.value) {
          <mat-option [value]="option.value">
            {{ language() === 'ar' ? option.labelAr : option.labelEn }}
          </mat-option>
        }
      </mat-select>
    </mat-form-field>
  </div>

  <!-- Review Cards -->
  @if (loading() && currentPage() === 1) {
    <div class="review-list__loading">
      <mat-icon class="spinner">hourglass_empty</mat-icon>
      <p>{{ language() === 'ar' ? 'جاري التحميل...' : 'Loading...' }}</p>
    </div>
  } @else if (reviews().length === 0) {
    <div class="review-list__empty">
      <mat-icon class="empty__icon">chat_bubble_outline</mat-icon>
      <p class="empty__text">{{ noReviewsLabel }}</p>
      <button mat-stroked-button color="primary" (click)="onWriteReview()">
        {{ writeReviewLabel }}
      </button>
    </div>
  } @else {
    <div class="review-list__items">
      @for (review of reviews(); track review.id) {
        <div class="review-card">
          <!-- User Info -->
          <div class="review-card__header">
            <div class="header__user">
              @if (review.user.avatar) {
                <img
                  [src]="review.user.avatar"
                  [alt]="review.user.fullName"
                  class="user__avatar"
                />
              } @else {
                <div class="user__avatar user__avatar--placeholder">
                  {{ getUserInitials(review.user.fullName) }}
                </div>
              }

              <div class="user__info">
                <div class="user__name">{{ review.user.fullName }}</div>
                @if (review.isVerifiedPurchase) {
                  <div class="user__verified">
                    <mat-icon class="verified__icon">verified</mat-icon>
                    <span>{{ verifiedPurchaseLabel }}</span>
                  </div>
                }
              </div>
            </div>

            <div class="header__date">
              {{ review.createdAt | date: 'mediumDate' }}
            </div>
          </div>

          <!-- Rating Stars -->
          <div class="review-card__rating">
            @for (icon of getStarIcons(review.rating); track $index) {
              <mat-icon class="rating__star">{{ icon }}</mat-icon>
            }
          </div>

          <!-- Review Title -->
          @if (getReviewTitle(review)) {
            <h4 class="review-card__title">{{ getReviewTitle(review) }}</h4>
          }

          <!-- Review Body -->
          @if (getReviewBody(review)) {
            <p class="review-card__body">{{ getReviewBody(review) }}</p>
          }

          <!-- Pros/Cons -->
          @if (review.pros && review.pros.length > 0) {
            <div class="review-card__pros">
              <div class="pros__label">
                <mat-icon class="pros__icon">check_circle</mat-icon>
                <span>{{ prosLabel }}</span>
              </div>
              <ul class="pros__list">
                @for (pro of review.pros; track $index) {
                  <li>{{ pro }}</li>
                }
              </ul>
            </div>
          }

          @if (review.cons && review.cons.length > 0) {
            <div class="review-card__cons">
              <div class="cons__label">
                <mat-icon class="cons__icon">cancel</mat-icon>
                <span>{{ consLabel }}</span>
              </div>
              <ul class="cons__list">
                @for (con of review.cons; track $index) {
                  <li>{{ con }}</li>
                }
              </ul>
            </div>
          }

          <!-- Helpful Button -->
          <div class="review-card__footer">
            <button
              mat-stroked-button
              class="footer__helpful-btn"
              (click)="onMarkHelpful(review)"
            >
              <mat-icon>thumb_up</mat-icon>
              <span>{{ helpfulLabel }} ({{ review.helpfulCount }})</span>
            </button>
          </div>
        </div>
      }
    </div>

    <!-- Load More Button -->
    @if (currentPage() < totalPages()) {
      <div class="review-list__load-more">
        <button
          mat-raised-button
          color="accent"
          (click)="onLoadMore()"
          [disabled]="loading()"
        >
          @if (loading()) {
            <mat-icon class="spinner">hourglass_empty</mat-icon>
          }
          <span>{{ loadMoreLabel }}</span>
        </button>
      </div>
    }
  }
</div>
