<!-- Product List Page - Syrian Marketplace -->
<div class="product-list" [class.product-list--rtl]="language() === 'ar'">
  <!-- Breadcrumb Navigation -->
  <div class="product-list__breadcrumb">
    <app-breadcrumb
      [items]="breadcrumbs()"
      [language]="language()">
    </app-breadcrumb>
  </div>

  <!-- Page Header -->
  <div class="product-list__header">
    <div class="product-list__title-section">
      <h1 class="product-list__title">
        {{ categorySlug() ? getCategoryName(categorySlug()!) : (language() === 'ar' ? 'جميع المنتجات' : 'All Products') }}
      </h1>
      <p class="product-list__subtitle" *ngIf="(products$ | async) as products">
        {{ language() === 'ar'
          ? products.length + ' منتج متاح'
          : products.length + ' products available' }}
      </p>
    </div>

    <!-- View Controls -->
    <div class="product-list__controls">
      <!-- Sort Dropdown -->
      <mat-form-field class="product-list__sort" appearance="outline">
        <mat-label>
          {{ language() === 'ar' ? 'ترتيب حسب' : 'Sort by' }}
        </mat-label>
        <mat-select
          [value]="(sortBy$ | async) || 'rating'"
          (selectionChange)="changeSortOption($event.value)">
          <mat-option
            *ngFor="let option of sortOptions"
            [value]="option.value">
            {{ language() === 'ar' ? option.labelArabic : option.label }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <!-- Items Per Page -->
      <mat-form-field class="product-list__per-page" appearance="outline">
        <mat-label>
          {{ language() === 'ar' ? 'عرض' : 'Show' }}
        </mat-label>
        <mat-select
          [value]="itemsPerPage()"
          (selectionChange)="changeItemsPerPage($event.value)">
          <mat-option
            *ngFor="let option of itemsPerPageOptions"
            [value]="option.value">
            {{ language() === 'ar' ? option.labelArabic : option.label }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <!-- View Toggle -->
      <div class="product-list__view-toggle">
        <button
          mat-icon-button
          [class.active]="viewMode() === 'grid'"
          (click)="viewMode() !== 'grid' && toggleViewMode()"
          [attr.aria-label]="language() === 'ar' ? 'عرض شبكي' : 'Grid view'">
          <mat-icon>grid_view</mat-icon>
        </button>
        <button
          mat-icon-button
          [class.active]="viewMode() === 'list'"
          (click)="viewMode() !== 'list' && toggleViewMode()"
          [attr.aria-label]="language() === 'ar' ? 'عرض قائمة' : 'List view'">
          <mat-icon>view_list</mat-icon>
        </button>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="product-list__loading" *ngIf="loading$ | async">
    <app-loader
      size="large"
      [message]="language() === 'ar' ? 'جاري تحميل المنتجات...' : 'Loading products...'">
    </app-loader>
  </div>

  <!-- Error State -->
  <div class="product-list__error" *ngIf="error$ | async as error">
    <app-alert
      type="error"
      [message]="language() === 'ar' ? 'حدث خطأ في تحميل المنتجات' : 'Error loading products'"
      [dismissible]="true">
    </app-alert>
  </div>

  <!-- Products Grid/List -->
  <div class="product-list__content" *ngIf="(loading$ | async) === false && !(error$ | async)">
    <ng-container *ngIf="(products$ | async) as products">
      <!-- Empty State -->
      <div class="product-list__empty" *ngIf="products.length === 0">
        <div class="product-list__empty-icon">
          <mat-icon>inventory_2</mat-icon>
        </div>
        <h2 class="product-list__empty-title">
          {{ language() === 'ar' ? 'لا توجد منتجات' : 'No products found' }}
        </h2>
        <p class="product-list__empty-text">
          {{ language() === 'ar'
            ? 'جرب تغيير معايير البحث أو المرشحات'
            : 'Try adjusting your search or filters' }}
        </p>
        <button
          mat-raised-button
          color="primary"
          routerLink="/products"
          class="product-list__empty-action">
          {{ language() === 'ar' ? 'تصفح جميع المنتجات' : 'Browse all products' }}
        </button>
      </div>

      <!-- Grid View -->
      <div
        class="product-list__grid"
        [class.product-list__grid--4-col]="viewMode() === 'grid'"
        *ngIf="products.length > 0 && viewMode() === 'grid'">
        <app-product-box-grid
          *ngFor="let product of products.slice((currentPage() - 1) * itemsPerPage(), currentPage() * itemsPerPage())"
          [product]="product"
          [language]="language()"
          (addToCart)="onAddToCart($event)"
          (addToWishlist)="onAddToWishlist($event)"
          (quickView)="onQuickView($event)">
        </app-product-box-grid>
      </div>

      <!-- List View -->
      <div
        class="product-list__list"
        *ngIf="products.length > 0 && viewMode() === 'list'">
        <app-product-box-list
          *ngFor="let product of products.slice((currentPage() - 1) * itemsPerPage(), currentPage() * itemsPerPage())"
          [product]="product"
          [language]="language()"
          (addToCart)="onAddToCart($event)"
          (addToWishlist)="onAddToWishlist($event)"
          (quickView)="onQuickView($event)">
        </app-product-box-list>
      </div>

      <!-- Pagination -->
      <div class="product-list__pagination" *ngIf="products.length > itemsPerPage()">
        <app-pagination
          [currentPage]="currentPage()"
          [totalItems]="products.length"
          [itemsPerPage]="itemsPerPage()"
          [language]="language()"
          (pageChange)="onPageChange($event)">
        </app-pagination>
      </div>
    </ng-container>
  </div>

  <!-- Heritage Badge Info -->
  <div class="product-list__footer" *ngIf="categorySlug() && (products$ | async)?.length">
    <div class="product-list__heritage-note">
      <mat-icon class="product-list__heritage-icon">verified</mat-icon>
      <p class="product-list__heritage-text">
        {{ language() === 'ar'
          ? 'جميع المنتجات مصنوعة يدوياً من قبل حرفيين سوريين معتمدين'
          : 'All products are handcrafted by certified Syrian artisans' }}
      </p>
    </div>
  </div>
</div>
