<!DOCTYPE html>
<html lang="en" dir="ltr" id="htmlRoot">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Category Analytics - SouqSyria Admin Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'golden-wheat': '#988561',
                        'golden-wheat-light': '#b9a779',
                        'golden-wheat-bg': '#edebe0',
                        'forest-green': '#002623',
                        'charcoal': '#161616'
                    }
                }
            }
        }
    </script>

    <style>
        :root {
            --golden-wheat: #988561;
            --golden-wheat-light: #b9a779;
            --golden-wheat-bg: #edebe0;
            --forest-green: #002623;
            --charcoal: #161616;
        }

        .bg-damascus-pattern {
            background-image:
                radial-gradient(circle at 30% 30%, rgba(152, 133, 97, 0.05) 1px, transparent 1px),
                radial-gradient(circle at 70% 70%, rgba(152, 133, 97, 0.05) 1px, transparent 1px);
            background-size: 60px 60px;
        }

        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--golden-wheat);
            border-radius: 3px;
        }

        .sidebar-transition {
            transition: all 0.3s ease-in-out;
        }

        .stats-card {
            transition: all 0.3s ease;
        }

        .stats-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(152, 133, 97, 0.15);
        }

        .btn-golden {
            background: linear-gradient(135deg, var(--golden-wheat), var(--golden-wheat-light));
            transition: all 0.3s ease;
        }

        .btn-golden:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(152, 133, 97, 0.3);
        }

        .arabic-text {
            font-family: 'Segoe UI', 'Arial Unicode MS', sans-serif;
        }

        .nav-active {
            background: linear-gradient(135deg, var(--golden-wheat), var(--golden-wheat-light));
            color: white;
            box-shadow: 0 4px 12px rgba(152, 133, 97, 0.3);
        }

        .table-hover:hover {
            background-color: rgba(152, 133, 97, 0.05);
        }

        .category-icon {
            width: 3rem;
            height: 3rem;
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .damascus-steel { background: linear-gradient(135deg, #4f46e5, #7c3aed); }
        .aleppo-crafts { background: linear-gradient(135deg, #059669, #0d9488); }
        .traditional-foods { background: linear-gradient(135deg, #dc2626, #ea580c); }
        .jewelry-accessories { background: linear-gradient(135deg, #7c2d12, #a16207); }
        .home-decor { background: linear-gradient(135deg, #1e40af, #1e3a8a); }
        .textiles-fabrics { background: linear-gradient(135deg, #be185d, #c2410c); }
        .beauty-wellness { background: linear-gradient(135deg, #0891b2, #0e7490); }
        .nuts-snacks { background: linear-gradient(135deg, #15803d, #166534); }

        .trend-up { color: #059669; }
        .trend-down { color: #dc2626; }
        .trend-neutral { color: #6b7280; }

        .seasonal-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 0.5rem;
        }

        .season-spring { background: #22c55e; }
        .season-summer { background: #eab308; }
        .season-autumn { background: #f97316; }
        .season-winter { background: #3b82f6; }

        .performance-bar {
            height: 4px;
            border-radius: 2px;
            background: #e5e7eb;
            overflow: hidden;
        }

        .performance-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--golden-wheat), var(--golden-wheat-light));
            transition: width 0.3s ease;
        }

        @media (max-width: 768px) {
            .sidebar-mobile {
                transform: translateX(-100%);
            }

            .sidebar-mobile.show {
                transform: translateX(0);
            }

            .main-content-mobile {
                margin-left: 0 !important;
            }
        }
    </style>
</head>
<body class="bg-gray-50 bg-damascus-pattern min-h-screen">
    <!-- Mobile Menu Overlay -->
    <div id="mobileOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden md:hidden"></div>

    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar fixed left-0 top-0 w-64 h-full bg-white shadow-xl z-50 sidebar-transition sidebar-mobile">
        <!-- Logo Section -->
        <div class="p-6 border-b border-gray-100">
            <div class="text-center">
                <h1 class="text-2xl font-bold arabic-text" style="color: var(--golden-wheat);">سوق سوريا</h1>
                <h2 class="text-lg font-semibold text-gray-700">SouqSyria</h2>
                <p class="text-sm text-gray-500 mt-1">Admin Portal</p>
            </div>
        </div>

        <!-- User Info -->
        <div class="p-4 border-b border-gray-100">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 rounded-full bg-gradient-to-br from-golden-wheat to-golden-wheat-light flex items-center justify-center">
                    <i class="fas fa-user text-white text-sm"></i>
                </div>
                <div>
                    <p class="font-semibold text-gray-800" id="adminName">Admin User</p>
                    <p class="text-xs text-gray-500" id="adminRole">System Administrator</p>
                </div>
            </div>
        </div>

        <!-- Navigation Menu -->
        <nav class="p-4 space-y-2">
            <a href="/admin-dashboard.html" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-gray-100 transition-all duration-200">
                <i class="material-icons text-lg">dashboard</i>
                <span class="font-medium">Dashboard</span>
                <span class="text-sm arabic-text mr-auto">لوحة التحكم</span>
            </a>

            <a href="/admin-users.html" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-gray-100 transition-all duration-200">
                <i class="material-icons text-lg">people</i>
                <span class="font-medium">Users</span>
                <span class="text-sm arabic-text mr-auto">المستخدمين</span>
            </a>

            <a href="/admin-categories.html" class="nav-item nav-active flex items-center space-x-3 px-4 py-3 rounded-lg transition-all duration-200">
                <i class="material-icons text-lg">category</i>
                <span class="font-medium">Categories</span>
                <span class="text-sm arabic-text mr-auto">التصنيفات</span>
            </a>

            <a href="/admin-vendors.html" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-gray-100 transition-all duration-200">
                <i class="material-icons text-lg">store</i>
                <span class="font-medium">Vendors</span>
                <span class="text-sm arabic-text mr-auto">التجار</span>
            </a>

            <a href="/admin-analytics.html" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-gray-100 transition-all duration-200">
                <i class="material-icons text-lg">analytics</i>
                <span class="font-medium">Analytics</span>
                <span class="text-sm arabic-text mr-auto">التحليلات</span>
            </a>

            <a href="/admin-financial.html" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-gray-100 transition-all duration-200">
                <i class="material-icons text-lg">account_balance</i>
                <span class="font-medium">Financial</span>
                <span class="text-sm arabic-text mr-auto">المالية</span>
            </a>

            <a href="/admin-system.html" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-gray-100 transition-all duration-200">
                <i class="material-icons text-lg">settings</i>
                <span class="font-medium">System</span>
                <span class="text-sm arabic-text mr-auto">النظام</span>
            </a>

            <a href="#" onclick="logout()" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-red-50 hover:text-red-600 transition-all duration-200 text-gray-600">
                <i class="material-icons text-lg">logout</i>
                <span class="font-medium">Logout</span>
                <span class="text-sm arabic-text mr-auto">تسجيل الخروج</span>
            </a>
        </nav>
    </aside>

    <!-- Main Content -->
    <main id="mainContent" class="main-content ml-64 main-content-mobile transition-all duration-300">
        <!-- Top Header -->
        <header class="bg-white shadow-sm border-b border-gray-100 sticky top-0 z-30">
            <div class="px-6 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <button id="mobileMenuBtn" class="md:hidden p-2 rounded-lg hover:bg-gray-100">
                            <i class="material-icons">menu</i>
                        </button>
                        <div>
                            <h1 class="text-2xl font-bold text-gray-800">Category Analytics</h1>
                            <p class="text-sm text-gray-500 arabic-text">تحليلات التصنيفات والتراث السوري</p>
                        </div>
                    </div>

                    <div class="flex items-center space-x-4">
                        <button onclick="toggleLanguage()" class="p-2 rounded-lg hover:bg-gray-100 transition-colors">
                            <i class="material-icons">language</i>
                            <span class="text-sm ml-1" id="currentLang">EN</span>
                        </button>

                        <select id="timeRangeFilter" class="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-golden-wheat focus:border-golden-wheat">
                            <option value="7">Last 7 Days</option>
                            <option value="30" selected>Last 30 Days</option>
                            <option value="90">Last 3 Months</option>
                            <option value="365">Last Year</option>
                        </select>

                        <button onclick="exportCategoryReport()" class="btn-golden text-white px-4 py-2 rounded-lg font-medium flex items-center space-x-2">
                            <i class="material-icons text-sm">file_download</i>
                            <span>Export Report</span>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Category Analytics Content -->
        <div class="p-6 space-y-6">
            <!-- Overview Stats -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <div class="stats-card bg-white rounded-xl p-6 shadow-sm border border-gray-100">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm font-medium">Total Categories</p>
                            <p class="text-sm text-gray-400 arabic-text">إجمالي التصنيفات</p>
                            <p class="text-3xl font-bold text-gray-800 mt-2">8</p>
                        </div>
                        <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                            <i class="material-icons text-blue-600">category</i>
                        </div>
                    </div>
                    <div class="mt-4 flex items-center text-sm">
                        <span class="text-green-500 font-medium">Heritage Focus</span>
                        <span class="text-gray-500 ml-2">Syrian Traditional</span>
                    </div>
                </div>

                <div class="stats-card bg-white rounded-xl p-6 shadow-sm border border-gray-100">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm font-medium">Best Performing</p>
                            <p class="text-sm text-gray-400 arabic-text">الأفضل أداءً</p>
                            <p class="text-lg font-bold text-gray-800 mt-2">Damascus Steel</p>
                        </div>
                        <div class="w-12 h-12 damascus-steel rounded-lg flex items-center justify-center">
                            <i class="fas fa-sword text-white"></i>
                        </div>
                    </div>
                    <div class="mt-4 flex items-center text-sm">
                        <i class="material-icons text-green-500 text-sm">trending_up</i>
                        <span class="text-green-500 font-medium ml-1">+24.3%</span>
                        <span class="text-gray-500 ml-2">this month</span>
                    </div>
                </div>

                <div class="stats-card bg-white rounded-xl p-6 shadow-sm border border-gray-100">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm font-medium">Seasonal Peak</p>
                            <p class="text-sm text-gray-400 arabic-text">ذروة الموسم</p>
                            <p class="text-lg font-bold text-gray-800 mt-2">Aleppo Crafts</p>
                        </div>
                        <div class="w-12 h-12 aleppo-crafts rounded-lg flex items-center justify-center">
                            <i class="fas fa-spa text-white"></i>
                        </div>
                    </div>
                    <div class="mt-4 flex items-center text-sm">
                        <span class="seasonal-indicator season-winter"></span>
                        <span class="text-blue-600 font-medium">Winter Season</span>
                    </div>
                </div>

                <div class="stats-card bg-white rounded-xl p-6 shadow-sm border border-gray-100">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm font-medium">Total Revenue</p>
                            <p class="text-sm text-gray-400 arabic-text">إجمالي الإيرادات</p>
                            <p class="text-2xl font-bold text-gray-800 mt-2">
                                <span id="totalCategoryRevenue">₪ 12.4M</span>
                                <p class="text-sm text-gray-400">($4,960)</p>
                            </p>
                        </div>
                        <div class="w-12 h-12 bg-gradient-to-br from-golden-wheat to-golden-wheat-light rounded-lg flex items-center justify-center">
                            <i class="material-icons text-white">attach_money</i>
                        </div>
                    </div>
                    <div class="mt-4 flex items-center text-sm">
                        <i class="material-icons text-green-500 text-sm">trending_up</i>
                        <span class="text-green-500 font-medium ml-1">+18.7%</span>
                        <span class="text-gray-500 ml-2">vs last period</span>
                    </div>
                </div>
            </div>

            <!-- Category Performance Grid -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Main Categories Table -->
                <div class="lg:col-span-2 bg-white rounded-xl shadow-sm border border-gray-100">
                    <div class="p-6 border-b border-gray-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="text-lg font-semibold text-gray-800">Syrian Heritage Categories</h3>
                                <p class="text-sm text-gray-500 arabic-text">تصنيفات التراث السوري</p>
                            </div>
                            <button onclick="refreshCategoryData()" class="text-golden-wheat hover:text-golden-wheat-light transition-colors">
                                <i class="material-icons">refresh</i>
                            </button>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Category</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Products</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Revenue</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Growth</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Performance</th>
                                </tr>
                            </thead>
                            <tbody id="categoriesTableBody" class="bg-white divide-y divide-gray-100">
                                <!-- Category rows will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Category Insights -->
                <div class="space-y-6">
                    <!-- Seasonal Trends -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-100">
                        <div class="p-6 border-b border-gray-100">
                            <h3 class="text-lg font-semibold text-gray-800">Seasonal Trends</h3>
                            <p class="text-sm text-gray-500 arabic-text">الاتجاهات الموسمية</p>
                        </div>
                        <div class="p-6 space-y-4">
                            <div class="flex items-center justify-between p-3 bg-blue-50 rounded-lg">
                                <div class="flex items-center space-x-3">
                                    <span class="seasonal-indicator season-winter"></span>
                                    <div>
                                        <p class="text-sm font-medium text-blue-900">Winter Peak</p>
                                        <p class="text-xs text-blue-700">Aleppo Soaps, Damascus Steel</p>
                                    </div>
                                </div>
                                <span class="text-sm font-bold text-blue-800">+32%</span>
                            </div>

                            <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg">
                                <div class="flex items-center space-x-3">
                                    <span class="seasonal-indicator season-spring"></span>
                                    <div>
                                        <p class="text-sm font-medium text-green-900">Spring Rise</p>
                                        <p class="text-xs text-green-700">Textiles, Home Decor</p>
                                    </div>
                                </div>
                                <span class="text-sm font-bold text-green-800">+18%</span>
                            </div>

                            <div class="flex items-center justify-between p-3 bg-yellow-50 rounded-lg">
                                <div class="flex items-center space-x-3">
                                    <span class="seasonal-indicator season-summer"></span>
                                    <div>
                                        <p class="text-sm font-medium text-yellow-900">Summer Steady</p>
                                        <p class="text-xs text-yellow-700">Traditional Foods, Nuts</p>
                                    </div>
                                </div>
                                <span class="text-sm font-bold text-yellow-800">+12%</span>
                            </div>

                            <div class="flex items-center justify-between p-3 bg-orange-50 rounded-lg">
                                <div class="flex items-center space-x-3">
                                    <span class="seasonal-indicator season-autumn"></span>
                                    <div>
                                        <p class="text-sm font-medium text-orange-900">Autumn Harvest</p>
                                        <p class="text-xs text-orange-700">Spices, Jewelry</p>
                                    </div>
                                </div>
                                <span class="text-sm font-bold text-orange-800">+15%</span>
                            </div>
                        </div>
                    </div>

                    <!-- Regional Performance -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-100">
                        <div class="p-6 border-b border-gray-100">
                            <h3 class="text-lg font-semibold text-gray-800">Regional Preferences</h3>
                            <p class="text-sm text-gray-500 arabic-text">التفضيلات الإقليمية</p>
                        </div>
                        <div class="p-6 space-y-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-800">Damascus - دمشق</p>
                                    <p class="text-xs text-gray-500">Damascus Steel, Jewelry</p>
                                </div>
                                <div class="text-right">
                                    <p class="text-sm font-bold text-gray-800">₪ 3.2M</p>
                                    <p class="text-xs text-gray-500">35% of total</p>
                                </div>
                            </div>

                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-800">Aleppo - حلب</p>
                                    <p class="text-xs text-gray-500">Soaps, Textiles</p>
                                </div>
                                <div class="text-right">
                                    <p class="text-sm font-bold text-gray-800">₪ 2.8M</p>
                                    <p class="text-xs text-gray-500">28% of total</p>
                                </div>
                            </div>

                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-800">Homs - حمص</p>
                                    <p class="text-xs text-gray-500">Traditional Foods</p>
                                </div>
                                <div class="text-right">
                                    <p class="text-sm font-bold text-gray-800">₪ 1.5M</p>
                                    <p class="text-xs text-gray-500">15% of total</p>
                                </div>
                            </div>

                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-800">Other Governorates</p>
                                    <p class="text-xs text-gray-500">Mixed Categories</p>
                                </div>
                                <div class="text-right">
                                    <p class="text-sm font-bold text-gray-800">₪ 2.1M</p>
                                    <p class="text-xs text-gray-500">22% of total</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Category Management -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-100">
                        <div class="p-6 border-b border-gray-100">
                            <h3 class="text-lg font-semibold text-gray-800">Quick Actions</h3>
                            <p class="text-sm text-gray-500 arabic-text">إجراءات سريعة</p>
                        </div>
                        <div class="p-6 space-y-3">
                            <button onclick="showAddCategoryModal()" class="w-full btn-golden text-white py-3 px-4 rounded-lg font-medium text-sm flex items-center justify-center space-x-2">
                                <i class="material-icons text-sm">add_circle</i>
                                <span>Add New Category</span>
                            </button>
                            <button onclick="manageCategoryHierarchy()" class="w-full bg-gray-100 hover:bg-gray-200 text-gray-700 py-3 px-4 rounded-lg font-medium text-sm flex items-center justify-center space-x-2 transition-colors">
                                <i class="material-icons text-sm">account_tree</i>
                                <span>Manage Hierarchy</span>
                            </button>
                            <button onclick="viewCategoryInsights()" class="w-full bg-gray-100 hover:bg-gray-200 text-gray-700 py-3 px-4 rounded-lg font-medium text-sm flex items-center justify-center space-x-2 transition-colors">
                                <i class="material-icons text-sm">insights</i>
                                <span>View Insights</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Category Performance Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Revenue Distribution Chart -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                    <div class="flex items-center justify-between mb-6">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-800">Revenue Distribution</h3>
                            <p class="text-sm text-gray-500 arabic-text">توزيع الإيرادات</p>
                        </div>
                    </div>
                    <div class="relative h-64">
                        <canvas id="revenueChart"></canvas>
                    </div>
                </div>

                <!-- Growth Trends Chart -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                    <div class="flex items-center justify-between mb-6">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-800">Growth Trends</h3>
                            <p class="text-sm text-gray-500 arabic-text">اتجاهات النمو</p>
                        </div>
                    </div>
                    <div class="relative h-64">
                        <canvas id="growthChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Heritage Product Spotlight -->
            <div class="bg-gradient-to-r from-golden-wheat to-golden-wheat-light rounded-xl p-6 text-white">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-xl font-bold mb-2">Syrian Heritage Spotlight</h3>
                        <p class="text-golden-wheat-bg opacity-90 arabic-text mb-4">أضواء على التراث السوري</p>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                            <div class="bg-white bg-opacity-20 rounded-lg p-3">
                                <p class="font-semibold">Damascus Steel</p>
                                <p class="opacity-90">World-renowned craftsmanship</p>
                                <p class="text-xs opacity-80">1,200+ years tradition</p>
                            </div>
                            <div class="bg-white bg-opacity-20 rounded-lg p-3">
                                <p class="font-semibold">Aleppo Laurel Soap</p>
                                <p class="opacity-90">Ancient beauty secrets</p>
                                <p class="text-xs opacity-80">Premium olive oil & laurel</p>
                            </div>
                            <div class="bg-white bg-opacity-20 rounded-lg p-3">
                                <p class="font-semibold">Brocade Textiles</p>
                                <p class="opacity-90">Luxury fabric heritage</p>
                                <p class="text-xs opacity-80">Hand-woven artistry</p>
                            </div>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-2xl font-bold">82%</p>
                        <p class="text-sm opacity-90">Heritage Category Share</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        /**
         * SouqSyria Category Analytics System
         * Comprehensive category performance analysis with Syrian heritage focus
         */

        // Global state
        let currentUser = null;
        let currentLanguage = 'en';
        let categories = [];
        let currentTimeRange = 30;

        /**
         * Sample category data with Syrian heritage focus
         */
        const sampleCategories = [
            {
                id: 1,
                name: 'Damascus Steel',
                nameArabic: 'الفولاذ الدمشقي',
                icon: 'fas fa-sword',
                iconClass: 'damascus-steel',
                products: 247,
                revenue: 3420000, // SYP
                revenueUSD: 1368,
                growth: 24.3,
                performance: 95,
                trend: 'up',
                seasonal: 'winter',
                description: 'World-renowned Damascus steel products including knives, swords, and decorative items',
                topProducts: ['Chef Knives', 'Decorative Swords', 'Jewelry']
            },
            {
                id: 2,
                name: 'Aleppo Crafts',
                nameArabic: 'حرف حلب',
                icon: 'fas fa-spa',
                iconClass: 'aleppo-crafts',
                products: 189,
                revenue: 2850000,
                revenueUSD: 1140,
                growth: 18.7,
                performance: 88,
                trend: 'up',
                seasonal: 'winter',
                description: 'Traditional Aleppo soaps and beauty products made with laurel oil',
                topProducts: ['Laurel Soap', 'Olive Oil Soap', 'Beauty Sets']
            },
            {
                id: 3,
                name: 'Traditional Foods',
                nameArabic: 'الأطعمة التقليدية',
                icon: 'fas fa-mortar-pestle',
                iconClass: 'traditional-foods',
                products: 156,
                revenue: 1920000,
                revenueUSD: 768,
                growth: 12.4,
                performance: 75,
                trend: 'up',
                seasonal: 'summer',
                description: 'Authentic Syrian spices, sweets, and traditional food products',
                topProducts: ['Seven Spice Mix', 'Baklava', 'Ma\'amoul']
            },
            {
                id: 4,
                name: 'Textiles & Fabrics',
                nameArabic: 'المنسوجات والأقمشة',
                icon: 'fas fa-cut',
                iconClass: 'textiles-fabrics',
                products: 132,
                revenue: 1650000,
                revenueUSD: 660,
                growth: 8.9,
                performance: 70,
                trend: 'up',
                seasonal: 'spring',
                description: 'Luxury Syrian brocade fabrics and traditional textiles',
                topProducts: ['Brocade Fabric', 'Silk Scarves', 'Prayer Rugs']
            },
            {
                id: 5,
                name: 'Jewelry & Accessories',
                nameArabic: 'المجوهرات والإكسسوارات',
                icon: 'fas fa-gem',
                iconClass: 'jewelry-accessories',
                products: 98,
                revenue: 1450000,
                revenueUSD: 580,
                growth: 15.6,
                performance: 82,
                trend: 'up',
                seasonal: 'autumn',
                description: 'Traditional Syrian jewelry and decorative accessories',
                topProducts: ['Silver Jewelry', 'Traditional Bracelets', 'Decorative Boxes']
            },
            {
                id: 6,
                name: 'Home & Decor',
                nameArabic: 'المنزل والديكور',
                icon: 'fas fa-home',
                iconClass: 'home-decor',
                products: 87,
                revenue: 980000,
                revenueUSD: 392,
                growth: 6.2,
                performance: 65,
                trend: 'neutral',
                seasonal: 'spring',
                description: 'Traditional Syrian home decoration and furniture pieces',
                topProducts: ['Walnut Chess Sets', 'Mosaic Tables', 'Brass Items']
            },
            {
                id: 7,
                name: 'Beauty & Wellness',
                nameArabic: 'الجمال والعافية',
                icon: 'fas fa-leaf',
                iconClass: 'beauty-wellness',
                products: 76,
                revenue: 720000,
                revenueUSD: 288,
                growth: -2.1,
                performance: 58,
                trend: 'down',
                seasonal: 'winter',
                description: 'Natural beauty products and wellness items from Syrian heritage',
                topProducts: ['Oud Perfume Oil', 'Rose Water', 'Natural Henna']
            },
            {
                id: 8,
                name: 'Nuts & Snacks',
                nameArabic: 'المكسرات والوجبات الخفيفة',
                icon: 'fas fa-seedling',
                iconClass: 'nuts-snacks',
                products: 64,
                revenue: 410000,
                revenueUSD: 164,
                growth: 4.8,
                performance: 60,
                trend: 'neutral',
                seasonal: 'summer',
                description: 'Premium Syrian nuts, dried fruits, and traditional snacks',
                topProducts: ['Aleppo Pistachios', 'Damascus Dates', 'Mixed Nuts']
            }
        ];

        /**
         * Initialize the application
         */
        document.addEventListener('DOMContentLoaded', function() {
            checkAuthentication();
            initializeMobileMenu();
            loadCategories();
            setupEventListeners();
            initializeCharts();
        });

        /**
         * Check authentication and load user data
         */
        function checkAuthentication() {
            const userData = localStorage.getItem('souqsyria_admin_user');
            if (!userData) {
                alert('Session expired. Please login again.');
                window.location.href = '/admin-login.html';
                return;
            }

            try {
                currentUser = JSON.parse(userData);
                displayUserInfo();
            } catch (error) {
                console.error('Error parsing user data:', error);
                localStorage.removeItem('souqsyria_admin_user');
                window.location.href = '/admin-login.html';
            }
        }

        /**
         * Display user information
         */
        function displayUserInfo() {
            if (!currentUser) return;
            document.getElementById('adminName').textContent = currentUser.name || 'Admin User';

            const roleElement = document.getElementById('adminRole');
            if (currentUser.role === 'admin') {
                roleElement.textContent = 'System Administrator';
                roleElement.style.color = 'var(--golden-wheat)';
            }
        }

        /**
         * Load and display categories
         */
        function loadCategories() {
            categories = [...sampleCategories];
            renderCategories();
        }

        /**
         * Render categories table
         */
        function renderCategories() {
            const tbody = document.getElementById('categoriesTableBody');

            tbody.innerHTML = categories.map(category => `
                <tr class="table-hover">
                    <td class="px-6 py-4">
                        <div class="flex items-center space-x-4">
                            <div class="category-icon ${category.iconClass}">
                                <i class="${category.icon} text-white"></i>
                            </div>
                            <div>
                                <p class="font-semibold text-gray-800">${category.name}</p>
                                <p class="text-sm text-gray-500 arabic-text">${category.nameArabic}</p>
                                <p class="text-xs text-gray-400">${category.description.substring(0, 50)}...</p>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="text-center">
                            <p class="text-lg font-bold text-gray-800">${category.products.toLocaleString()}</p>
                            <p class="text-xs text-gray-500">products</p>
                        </div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="text-right">
                            <p class="font-semibold text-gray-800">₪ ${(category.revenue / 1000).toFixed(0)}K</p>
                            <p class="text-xs text-gray-500">($${category.revenueUSD})</p>
                        </div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="flex items-center space-x-2">
                            <i class="material-icons text-sm ${category.trend === 'up' ? 'trend-up' : category.trend === 'down' ? 'trend-down' : 'trend-neutral'}">
                                ${category.trend === 'up' ? 'trending_up' : category.trend === 'down' ? 'trending_down' : 'trending_flat'}
                            </i>
                            <span class="font-semibold ${category.trend === 'up' ? 'trend-up' : category.trend === 'down' ? 'trend-down' : 'trend-neutral'}">
                                ${category.growth > 0 ? '+' : ''}${category.growth}%
                            </span>
                        </div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="space-y-2">
                            <div class="performance-bar">
                                <div class="performance-fill" style="width: ${category.performance}%"></div>
                            </div>
                            <div class="flex justify-between text-xs text-gray-500">
                                <span>${category.performance}%</span>
                                <span class="seasonal-indicator season-${category.seasonal}"></span>
                            </div>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        /**
         * Setup event listeners
         */
        function setupEventListeners() {
            document.getElementById('timeRangeFilter').addEventListener('change', function(e) {
                currentTimeRange = parseInt(e.target.value);
                refreshCategoryData();
            });
        }

        /**
         * Initialize charts
         */
        function initializeCharts() {
            initializeRevenueChart();
            initializeGrowthChart();
        }

        /**
         * Initialize revenue distribution chart
         */
        function initializeRevenueChart() {
            const ctx = document.getElementById('revenueChart').getContext('2d');

            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: categories.map(cat => cat.name),
                    datasets: [{
                        data: categories.map(cat => cat.revenue),
                        backgroundColor: [
                            '#4f46e5', '#059669', '#dc2626', '#be185d',
                            '#7c2d12', '#1e40af', '#0891b2', '#15803d'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                usePointStyle: true,
                                padding: 15,
                                font: {
                                    size: 11
                                }
                            }
                        }
                    }
                }
            });
        }

        /**
         * Initialize growth trends chart
         */
        function initializeGrowthChart() {
            const ctx = document.getElementById('growthChart').getContext('2d');

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: categories.map(cat => cat.name),
                    datasets: [{
                        label: 'Growth %',
                        data: categories.map(cat => cat.growth),
                        backgroundColor: categories.map(cat =>
                            cat.growth > 15 ? '#059669' :
                            cat.growth > 0 ? '#eab308' : '#dc2626'
                        ),
                        borderRadius: 4,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        },
                        x: {
                            ticks: {
                                maxRotation: 45,
                                font: {
                                    size: 10
                                }
                            }
                        }
                    }
                }
            });
        }

        /**
         * Refresh category data
         */
        function refreshCategoryData() {
            // Simulate data refresh
            setTimeout(() => {
                loadCategories();
                showNotification('Category data refreshed successfully', 'success');
            }, 1000);
        }

        /**
         * Export category report
         */
        function exportCategoryReport() {
            const csv = generateCategoryCSV(categories);
            downloadCSV(csv, `souqsyria_category_analytics_${new Date().toISOString().split('T')[0]}.csv`);
            showNotification('Category analytics report exported successfully', 'success');
        }

        /**
         * Show add category modal
         */
        function showAddCategoryModal() {
            alert('Add New Category functionality would open a modal here with form fields for:\n\n• Category Name (English/Arabic)\n• Description\n• Icon Selection\n• Parent Category\n• Syrian Heritage Classification\n• Seasonal Information\n• Regional Associations');
        }

        /**
         * Manage category hierarchy
         */
        function manageCategoryHierarchy() {
            alert('Category Hierarchy Management would show:\n\n• Drag-and-drop category tree\n• Subcategory relationships\n• Heritage category groupings\n• Regional category assignments\n• Product count per hierarchy level');
        }

        /**
         * View category insights
         */
        function viewCategoryInsights() {
            alert('Category Insights Dashboard would display:\n\n• Deep performance analytics\n• Customer behavior patterns\n• Seasonal forecasting\n• Regional preference analysis\n• Heritage category trends\n• Competitive positioning');
        }

        /**
         * Utility functions
         */
        function generateCategoryCSV(data) {
            const headers = [
                'Category ID', 'Name', 'Arabic Name', 'Products', 'Revenue (SYP)',
                'Revenue (USD)', 'Growth %', 'Performance %', 'Trend', 'Season'
            ];

            const rows = data.map(cat => [
                cat.id,
                cat.name,
                cat.nameArabic,
                cat.products,
                cat.revenue,
                cat.revenueUSD,
                cat.growth,
                cat.performance,
                cat.trend,
                cat.seasonal
            ]);

            return [headers, ...rows].map(row =>
                row.map(field => `"${field}"`).join(',')
            ).join('\n');
        }

        function downloadCSV(csv, filename) {
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        function showNotification(message, type = 'info') {
            console.log(`${type}: ${message}`);
        }

        /**
         * Mobile menu functionality
         */
        function initializeMobileMenu() {
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobileOverlay');

            mobileMenuBtn.addEventListener('click', function() {
                sidebar.classList.toggle('show');
                overlay.classList.toggle('hidden');
            });

            overlay.addEventListener('click', function() {
                sidebar.classList.remove('show');
                overlay.classList.add('hidden');
            });
        }

        /**
         * Toggle language
         */
        function toggleLanguage() {
            const htmlRoot = document.getElementById('htmlRoot');
            const currentLangElement = document.getElementById('currentLang');

            if (currentLanguage === 'en') {
                currentLanguage = 'ar';
                htmlRoot.setAttribute('dir', 'rtl');
                htmlRoot.setAttribute('lang', 'ar');
                currentLangElement.textContent = 'العربية';
            } else {
                currentLanguage = 'en';
                htmlRoot.setAttribute('dir', 'ltr');
                htmlRoot.setAttribute('lang', 'en');
                currentLangElement.textContent = 'EN';
            }
        }

        /**
         * Logout functionality
         */
        function logout() {
            const confirmed = confirm('Are you sure you want to logout?\nهل أنت متأكد من تسجيل الخروج؟');

            if (confirmed) {
                localStorage.removeItem('souqsyria_admin_user');
                window.location.href = '/admin-login.html';
            }
        }
    </script>
</body>
</html>