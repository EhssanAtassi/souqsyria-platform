# ============================================================================
# MySQL 8.0 Production Configuration
# ============================================================================
# Optimized settings for SouqSyria e-commerce platform
# Performance tuning for medium-scale deployments
# File: docker/mysql/my.cnf
# ============================================================================

[mysqld]

# =========================================================================
# Storage Engine Configuration
# =========================================================================

# Default storage engine (InnoDB for ACID transactions)
default-storage-engine=InnoDB

# InnoDB buffer pool size (50-80% of available RAM)
# Set to 1GB for 2GB container
innodb_buffer_pool_size=1G

# InnoDB log file size (25% of buffer pool)
innodb_log_file_size=256M

# Number of buffer pool instances (for better concurrency)
innodb_buffer_pool_instances=4

# =========================================================================
# Connection Configuration
# =========================================================================

# Maximum number of connections
max_connections=200

# Maximum allowed packet size
max_allowed_packet=256M

# Connection idle timeout (in seconds)
wait_timeout=28800

# Interactive connection timeout
interactive_timeout=28800

# =========================================================================
# Performance Configuration
# =========================================================================

# Thread cache size (pool of threads for faster connection handling)
thread_cache_size=100

# Query cache (disabled in MySQL 8.0)
# query_cache_type=0
# query_cache_size=0

# Skip DNS lookup for faster authentication
skip-name-resolve

# Enable slow query log for monitoring
slow_query_log=1
slow_query_log_file=/var/log/mysql/slow-query.log
long_query_time=2
log_queries_not_using_indexes=1

# =========================================================================
# Replication Configuration
# =========================================================================

# Server ID (unique per instance)
server-id=1

# Enable binary logging for replication and backups
log_bin=/var/log/mysql/mysql-bin.log

# Binlog format (row format recommended for consistency)
binlog_format=ROW

# Expire binary logs after 7 days
expire_logs_days=7

# =========================================================================
# Character Set and Collation
# =========================================================================

# Default character set (UTF-8 for international support)
character-set-server=utf8mb4

# Default collation
collation-server=utf8mb4_unicode_ci

# Skip character set negotiation
skip-character-set-client-handshake

# =========================================================================
# InnoDB Settings
# =========================================================================

# InnoDB flush method (O_DIRECT avoids double buffering)
innodb_flush_method=O_DIRECT

# InnoDB lock wait timeout (in seconds)
innodb_lock_wait_timeout=50

# Enable InnoDB file per table (easier backup and recovery)
innodb_file_per_table=1

# InnoDB checksum algorithm
innodb_checksum_algorithm=crc32

# =========================================================================
# Logging Configuration
# =========================================================================

# Error log location
log-error=/var/log/mysql/error.log

# Log warnings
log_warnings=2

# Log all statements (only for development - disable in production)
# general_log=1
# general_log_file=/var/log/mysql/general.log

# =========================================================================
# Temporary Files
# =========================================================================

# Temporary table directory
tmpdir=/tmp

# Maximum temporary file size
tmp_table_size=256M
max_heap_table_size=256M

# =========================================================================
# Sort and Join Buffers
# =========================================================================

# Sort buffer for ORDER BY
sort_buffer_size=4M

# Read buffer for sequential scans
read_buffer_size=2M

# Write buffer for INSERT statements
write_buffer_size=2M

# Join buffer size
join_buffer_size=4M

# =========================================================================
# MyISAM Configuration (not used, but defined for safety)
# =========================================================================

# MyISAM recovery mode
myisam_recover_options=BACKUP,FORCE

# =========================================================================
# Security Configuration
# =========================================================================

# Disable symbolic links (security)
skip_symbolic_links=1

# =========================================================================
# Client Configuration
# =========================================================================

[client]

# Default character set for client connections
default-character-set=utf8mb4

# MySQL port
port=3306

# =========================================================================
# MySQL Connection Information
# =========================================================================

[mysql]

# Prompt format for MySQL shell
prompt=mysql [\\d]>

# =========================================================================
# mysqldump Configuration
# =========================================================================

[mysqldump]

# Character set for dump
default-character-set=utf8mb4

# Quick dump (don't buffer result set in memory)
quick

# Max allowed packet
max_allowed_packet=256M

# Lock tables during dump
lock-tables=0

# Dump with GTID for replication
set-gtid-purged=OFF

# =========================================================================
# Database Optimization
# =========================================================================

# Table cache size
table_cache=4000
table_definition_cache=2000

# Concurrent inserts
concurrent_insert=2

# Auto increment increment for replication
auto_increment_increment=1

# =========================================================================
# Audit and Compliance
# =========================================================================

# Enforce STRICT_TRANS_TABLES mode
sql_mode='STRICT_TRANS_TABLES,NO_ZERO_DATE,NO_ZERO_IN_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION'
